# 索引

## knowledge hierarchy

### destination

1. 什么是联合索引, 覆盖索引
2. 什么是列的离散性, 什么是最左匹配原则

### Tip

- 索引列的数据长度能少则少。
- 索引一定不是越多越好，越全越好，一定是建合适的。
- 匹配列前缀可用到索引 like 9999%，like %9999%、like %9999用不到索引；
- 对于模糊查询 like gupao%, 若匹配到的数据较少,则会用到索引, 但若匹配的数据过多,则会进行全表扫描, 而不会用到索引
- Where 条件中 not in 和 <>操作无法使用索引；
- 匹配范围值，order by 也可用到索引；
- 多用指定列查询，只返回自己想到的数据列，少用select \*；
- 联合索引中如果不是按照索引最左列开始查找，无法使用索引；
- 联合索引中精确匹配最左前列并范围匹配另外一列可以用到索引；
- 联合索引中如果查询中有某个列的范围查询，则其右边的所有列都无法使用索引；
- 列的离散性越大, 选择性越多, 越适合建立索引.
- 索引的字段最好不要用null, 否则在索引的时候会用到额外的空间.

---

[TOC]

## 索引基础

1. 索引
   索引是为了加速对表中数据行的检索而创建的一种分散存储的数据结构. 正确的创建合适的索引是提升数据库查询性能的基础.
   索引是对数据库表中一列或多列的值进行排序的一种结构，使用索引可快速访问数据库表中的特定信息。
   - 索引能极大的减少存储引擎需要扫描的数据量
   - 索引可以把随机IO变成顺序IO
   - 索引可以帮助我们在进行分组、排序等操作时，避免使用临时表

2. 相关词汇

   单列索引 & 联合索引
   单列索引 : 节点中关键字[name]
   联合索引 : 节点中关键字[name,phoneNum]
   联合索引列选择原则
      - 经常用的列优先 【最左匹配原则】
      - 选择性（离散度）高的列优先【离散度高原则】
      - 宽度小的列优先【最少空间原则】

   覆盖索引 : 如果查询列可通过索引节点中的关键字直接返回，则该索引称之为覆盖索引。覆盖索引可减少数据库IO，将随机IO变为顺序IO，可提高查询性能.

   > eg :

   ```sql
   -- 经排查发现最常用的sql语句：
   Select * from users where name = ? ;
   Select * from users where name = ? and phoneNum = ?;
   -- 机灵的李二狗的解决方案：
   create index idx_name on users(name); -- 错误✖, 只有name能够使用到索引,
   create index idx_name_phoneNum on users(name,phoneNum); -- 正确✔, 应为最左匹配原则, 上面两条查询语句name和phonenum都可以充分使用到索引
   ```

   非聚集索引 : 一种索引，该索引中索引的逻辑顺序与磁盘上行的物理存储顺序不同。
   聚集索引 : 一种索引，该索引中键值的逻辑顺序决定了表中相应行的物理顺序。

　　> 聚集索引对于那些经常要搜索范围值的列特别有效。使用聚集索引找到包含第一个值的行后，便可以确保包含后续索引值的行在物理相邻。例如，如果应用程序执行 的一个查询经常检索某一日期范围内的记录，则使用聚集索引可以迅速找到包含开始日期的行，然后检索表中所有相邻的行，直到到达结束日期。这样有助于提高此 类查询的性能。同样，如果对从表中检索的数据进行排序时经常要用到某一列，则可以将该表在该列上聚集（物理排序），避免每次查询该列时都进行排序，从而节 省成本。 
　　> 当索引值唯一时，使用聚集索引查找特定的行也很有效率。例如，使用唯一雇员 ID 列 emp_id 查找特定雇员的最快速的方法，是在 emp_id 列上创建聚集索引或 PRIMARY KEY 约束。
